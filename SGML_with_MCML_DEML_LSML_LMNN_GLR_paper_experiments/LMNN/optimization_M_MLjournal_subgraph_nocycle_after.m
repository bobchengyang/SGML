function [ M, scaled_M, scaled_factors, M_current_eigenvector, ...
    league_vec,...
    bins,...
    time_lp,...
    time_gs,...
    time_grad] = ...
    optimization_M_MLjournal_subgraph_nocycle_after(partial_feature,...
    feature_N,...
    x_original,...
    M,...
    scaled_M,...
    bins,...
    scaled_factors,...
    rho,...
    tol_offdiagonal,...
    M_current_eigenvector,...
    league_vec,...
    lobpcg_random_control,...
    tol_golden_search,...
    S_upper,...
    time_lp,...
    time_gs,...
    time_grad,...
    time_i,...
    nv,...
    zz,...
    targets_ind,...
    same_label,...
    partial_sample)

objective_previous = lmnn_obj(targets_ind,same_label,M,partial_feature,partial_sample);
tic;
[G] = lmnn_gradient(targets_ind,...
    same_label,...
    M,...
    partial_feature,...
    partial_sample,...
    feature_N,...
    zz,...
    0,...
    0,...
    nv);
time_grad(time_i)=time_grad(time_i)+toc;
[M,...
    scaled_M,...
    scaled_factors,...
    bins,...
    objective_temp,...
    time_lp,...
    time_gs,...
    time_grad] = optimization_M_ns_cell_MLjournal_subgraph_FULL_gs_ws(partial_feature,league_vec,...
    scaled_M,...
    bins,...
    scaled_factors,...
    feature_N,...
    G,...
    M,...
    x_original,...
    rho,...
    lobpcg_random_control,...
    tol_golden_search,...
    objective_previous,...
    S_upper,...
    time_lp,...
    time_gs,...
    time_grad,...
    time_i,...
    nv,...
    zz,...
    targets_ind,...
    same_label,...
    partial_sample);

end




